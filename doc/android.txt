# compiling for android is currently only working on linux (for me)
# pull requests appreciated
# use the official ndk toolchain file (the newest version) and cmake 3.6 (3.7 does not work somehow)
# also use clang and the clang stl since we need c++17 support (clang 3.8 is ok)
# work in progress

# set Android=1 to enable ny android support
# platform is needed for vulkan support
# we link to libc++ for c++14 support
# the undefined symbols are needed for the extern main decl (cant this done better??)
cmake -G Ninja ../.. \
    -DCMAKE_TOOLCHAIN_FILE=/opt/android-ndk/build/cmake/android.toolchain.cmake \
    -DAndroid=1 -DDependOnNytl=0 -DANDROID_STL=c++_static \
    -DANDROID_ALLOW_UNDEFINED_SYMBOLS=1 -DANDROID_CPP_FEATURES="rtti exceptions" \
	-DANDROID_PLATFORM=android-24


# it is additionally needed (as for most compiler toolchain setups atm) to manually copy
# an any header file implementation into an include path

# for clang complete (not working)
-gcc-toolchain
/opt/android-ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64
--sysroot=/opt/android-ndk/platforms/android-9/arch-arm
-isystem
/opt/android-ndk/sources/cxx-stl/llvm-libc++/include
-isystem
/opt/android-ndk/sources/android/support/include
-isystem
/opt/android-ndk/sources/cxx-stl/llvm-libc++abi/include




# needed: jni/android.mk, jni/application.mk, jni/libny.so, AndroidManifest.xml
# building:
ndk-build
android update project -t android-24 --name ny-android --path .
ant debug
ndk-build && ant debug && adb install -r bin/ny-android-debug.apk && adb logcat
# start the app on the connected smartphone


# shortform, run in build/test
ninja -C .. ny && cp ../src/ny/libny.so jni/libny.so && ndk-build && ant debug && adb install -r bin/ny-android-debug.apk && adb logcat
